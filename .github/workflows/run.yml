name: Cpp project autobuild

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: install google test and other libraries
        shell: bash
        run: sudo apt-get install libgtest-dev && cd /usr/src/gtest && sudo apt-get install doxygen && sudo apt-get install graphviz && sudo apt-get install clang-format && sudo apt-get install clang-tidy && sudo apt-get install cppcheck && sudo apt-get install libboost-all-dev && sudo cmake CMakeLists.txt && sudo make
      - name: Checkout Project
        uses: actions/checkout@v4.1.7
      - name: CMake Action
        uses: threeal/cmake-action@v2.0.0
        with:
          generator: "Unix Makefiles"
      - name: Static Analysis
        working-directory: ${{github.workspace}}/build
        run: make analysis
      - name: Format Code
        working-directory: ${{github.workspace}}/build
        run: |
          make format
           make format-check
          make format-check-changed
      - name: Unit Testing
        working-directory: ${{github.workspace}}/build
        run: make test
      - name: Documentation
        working-directory: ${{github.workspace}}/build
        run: make doxygen
      - name: Installation
        working-directory: ${{github.workspace}}/build
        run: make install
